@model Epi.Web.MVC.Models.FormModel
@{
	ViewBag.Title = "Epi Web Enter - My Forms";// + " - "+ 
	// Model.SurveyName + " - " + Model.IsDraftModeStyleClass;
	Layout = "~/Views/Shared/_Layout.cshtml";
	
}
@*<script type="text/javascript" >

	  $(document).ready(function () {
		  // a workaround for a flaw in the demo system (http://dev.jqueryui.com/ticket/4375), ignore!




		  $("#VideoDialog").dialog({
			  autoOpen: false,
			  show: "blind",
			  hide: "blind",
			  resizable: false,
			  height: 410,
			  width: 500,
			  modal: true
		  });

	  });

</script>*@


<script type="text/jscript">


	$(function () {

		$("#exitdialog").dialog({
			autoOpen: false,
			show: "blind",
			hide: "blind",
			resizable: false,
			height: 150,
			width: 420,
			modal: true,
			buttons: [{

				"text": 'Yes',
				"click": function () {
					$.ajax({

						//    url: 'Home/Delete/'+ $("#exitdialog").data('ResponseId') + '/' + '@ViewBag.UserId',
						url: '@Url.Action("Delete","Home")' + '?ResponseId=' + $("#exitdialog").data('ResponseId'),
						type: 'POST',
						contentType: 'application/json; charset=utf-8',
						success: successFunc,
						error: errorFunc
					});

					$.ajaxSetup({ cache: false });

					function successFunc(data, status) {
						$("#exitdialog").dialog("close");
						ReadResponses($('#hidFormId').val(), $('#hidPageNumber').val());
					}

					function errorFunc() {
						alert('error');
					}

				},
				"class": 'dialogbtn'

			}, {
				"text": 'No',
				"click": function () {
					$(this).dialog("close");
				},
				"class": 'dialogbtn'

			}]

		});


		$(document).on("click", "button[name='DeleteButton']", function (e) {
			e.preventDefault();
			$("#exitdialog")
						.data('ResponseId', $(this).attr("value"))
						.dialog("open");

		});



		$("button[class*='metro-tile']").click(function (e) {
			e.preventDefault();
			SetSettingButtonValue($(this).attr('data-FormId'));
			$("button[class*='metro-tile']").removeClass('metro-set');
			$(this).addClass('metro-set');
			$("#right").show();
			//   alert('1');
			$.ajax({
				url: '@Url.Action("ReadResponseInfo","Home")' + '?formid=' + $(this).attr('data-FormId'),
				type: 'GET',
				contentType: 'application/json; charset=utf-8',
				//data: JSON.stringify(model),
				success: successFunc,
				error: errorFunc
			});
			$.ajaxSetup({ cache: false });

			function successFunc(data, status) {
				$('#right').html(data);
			}

			function errorFunc() {
				alert('error');
			}

		});
		/////////////////////




		//////////////////////
		$(document).on("click", "a[name='lnkPager']", function (e) {
			e.preventDefault();

			ReadResponses($(this).attr('data-formid'), $(this).attr('data-pagenumber'));
		});

		function ReadResponses(formid, pagenumber) {
			 //alert('2');
			$.ajax({
				url: '@Url.Action("ReadResponseInfo","Home")' + '?formid=' + formid + "&page=" + pagenumber,
				type: 'GET',
				contentType: 'application/json; charset=utf-8',
				//data: JSON.stringify(model),
				success: successFunc
			});

			$.ajaxSetup({ cache: false });

			function successFunc(data, status) {
				$('#right').html(data);
			}

			function errorFunc() {
				alert('error');
			}
		}


		$("#dropdown-1").change(function () {

			FilterRecords(this);
			$("#right").hide();
			$("button[class*='metro-tile']").removeClass('metro-set');
			$("button:visible").triggerHandler('click');
		});


		//  $("button:visible").triggerHandler('click');

	});


	$(document).ready(function () {
	    // e.preventDefault();

	    //$(this).addClass('metro-set');
	    var ActionUrl = "";
	    var Url = window.location.pathname;
	    var ResultUrl = "";
	    if (Url.indexOf("/") != -1)
	        ResultUrl = Url.substring(Url.lastIndexOf("/") + 1);
	    else
	        ResultUrl = Url;

	    var FieldId = "#" + ResultUrl
	    //alert(ResultUrl);
	    if (ResultUrl.toUpperCase() != "HOME" && ResultUrl.toUpperCase() != "INDEX") {

	        $("button[class*='metro-tile']").removeClass('metro-set');
	        $(FieldId).addClass('metro-set');
	        ActionUrl = '@Url.Action("ReadResponseInfo","Home")' + "?formid= " + ResultUrl;
	        ReadResponse(ActionUrl);
	    }
	    else {

	        $("button:visible").triggerHandler('click');

	    }

	    $("#right").show();

	    // setup the dialog
	    $("#TimeOutdialog").dialog({
	        autoOpen: false,
	        modal: true,
	        width: 400,
	        height: 160,
	        closeOnEscape: false,
	        draggable: false,
	        resizable: false,
	        /* buttons: {
	        'Continue Session': function () {
	        $(this).dialog('close');
	        }
	        }*/

	        buttons: [{
	            "text": 'Continue Session',
	            "click": function () {
	                $(this).dialog('close');
	            },
	            "class": 'dialogbtn'
	        }]


	    });
	    // cache a reference to the countdown element so we don't have to query the DOM for it on each ping.
	    var $countdown = $("#dialog-countdown");

	    // start the idle timer plugin
	    $.idleTimeout('#TimeOutdialog', 'div.ui-dialog-buttonpane button:first', {
	        idleAfter: 900,
	        pollingInterval: 2,
	        keepAliveURL: 'keepalive.php',
	        serverResponseEquals: 'OK',
	        onTimeout: function () {
	            //window.location = "timeout.htm";
	            window.location = '@Url.Action("Index","Login")';
	            //'/Login';

	            //GetRedirectionUrl() + '/1';
	            //'~/Login/Index'; 


	        },
	        onIdle: function () {
	            $(this).dialog("open");
	        },
	        onCountdown: function (counter) {
	            $countdown.html(counter); // update the counter
	        }
	    });

	});
function ReadResponse(ActionUrl) {

		var Url = window.location.pathname;
		var Formid = "";
		if (Url.indexOf("/") != -1) 
		{
			Formid = Url.substring(Url.lastIndexOf("/") + 1);
			SetSettingButtonValue(Formid);
		}
		$.ajax({
			url: ActionUrl,
			type: 'GET',
			contentType: 'application/json; charset=utf-8',
			//data: JSON.stringify(model),
			success: successFunc,
			Error: errorFunc
		});
		$.ajaxSetup({ cache: false });

		function successFunc(data, status) {
		    $('#right').html(data);
		   
		}

		function errorFunc() {
			alert('error');
		}

	}

	function GetSettings() 
	{
		var ActionUrl = '@Url.Action("GetSettings","Home")' + '?formid=' + $("#FORM_ID_HIDDEN").val();
		 $.ajax({
			 url: ActionUrl,
			 type: 'GET',
			 contentType: 'application/json; charset=utf-8',
			 //data: JSON.stringify(model),
			 success: successFunc,
			 Error: errorFunc
		 });
		 $.ajaxSetup({ cache: false });

		 function successFunc(data, status) {
		     $('#right').html(data);

		 }

		 function errorFunc() {
			 alert('error');
		 }

}
function SaveSettings() {
   
    if ($('select#SelectedColumns option').length>0) {
	                $('#SelectedColumns option').prop('selected', true);
	                $('#SelectedUser option').prop('selected', true);
	                var ActionUrl = '@Url.Action("SaveSettings","Home")' + '?formid=' + $("#FORM_ID_HIDDEN").val();
	                var _form = $("#formsList").serialize();
	                //alert(form);
	                $.ajax({
		                url: ActionUrl,
		                type: 'POST',
		                //contentType: 'application/json; charset=utf-8',
		                data: _form,
		                dataType: "html",
		
		success: successFunc,
		Error: errorFunc
});

		        }
		        else {
		            alert('User should select at least one column.');
		            $('select#SelectedColumns option').focus();
		        }

 
	$.ajaxSetup({ cache: false });

	function successFunc(data, status) {
	    $('#right').html(data);
	    $('#dropdown-1').focus();
	    var FormId = $("#FORM_ID_HIDDEN").val();
	    var FormMode = $("#FORM_MODE_HIDDEN").val();

        if(FormMode =="Production"){

            $('#' + FormId).removeClass("metro-staging");
            $('#' + FormId).addClass("metro-prod");
        }
	    if (FormMode =="Staging") {
	        $('#' + FormId).removeClass("metro-prod")
	        $('#' + FormId).addClass("metro-staging");
            }
	}

	                function errorFunc() {
		                alert('error');
	                }
//    }
// else
//     {
//         alert('User should select at least one column.');
//         $('select#SelectedColumns option').focus();
//    }
}
//CancelChange
	function CancelChange() 
	{
	   
		var ActionUrl = '@Url.Action("ReadResponseInfo","Home")' + '?formid=' + $("#FORM_ID_HIDDEN").val();
		ReadResponse(ActionUrl);
		$('#dropdown-1').focus();
	}
	function SetSettingButtonValue(formid) 
	{
	    $("#FORM_ID_HIDDEN").val(formid);
	   
	}

	function SetSettingMode() {
	     
	    $("#FORM_MODE_HIDDEN").val($('#FormMode').find(":selected").text());

	}
</script>
<script>
	$(document).ajaxStop(function () {

		var leftHeight = $("#left").height();
		var rightHeight = $("#right").height();
		if (leftHeight > rightHeight) { $("#right").height(leftHeight) }
		else { $("#left").height(rightHeight) };
	});

</script>
<div id="pageHeader">
	<div id="pageTitle">
		<h2>
			My Forms</h2>
	</div>
	<div id="userwelcome">
		Welcome <strong>@Model.UserFirstName&nbsp;@Model.UserLastName </strong>&nbsp; | &nbsp;
	  @*  <a href="#">Log Out</a>*@
	  @Html.ActionLink("Log Out", "LogOut", "Home", null, null)	
		</div>
	<div style="clear: both;">
	</div>
</div>
<div id="content" style="@*margin-bottom: 200px;*@ padding-left: 10px; min-height: 375px;">
	<div id="leftarrangeby" style="float: left; vertical-align: middle; width: 320px;">
		<span class="css3-metro-dropdown">
			<select id="dropdown-1">
			   @* <option value="0" selected="selected" disabled="disabled">Arrange by:</option>*@
				<option value="1">My Forms</option>
				<option value="2">Forms Assigned to Me</option>
				<option value="3" selected="selected">All Forms</option>
				@*	<option value="3">Last Saved Forms First</option>*@
			</select>
		</span>
	</div>
	<div id="rightlegend" style="float: left; font-size: 9pt; vertical-align: baseline;
		margin-top: 8px;">
		<div id="Div1" style="display: inline; margin-right: 30px;">
			<img alt="" src="~/Content/images/designlegend.png" align="middle" style="width: 16px;
				vertical-align: middle;" />
			My Forms</div>
		<div id="Div2" style="display: inline; margin-right: 30px;">
			<img alt="" src="~/Content/images/collectlegend.png" align="middle" style="width: 16px;
				vertical-align: middle;" />
			Forms Assigned to Me</div>
		<div id="Div4" style="display: inline; margin-right: 30px;">
			<img alt="" src="~/Content/images/prodlegend1.png" align="middle" style="width: 16px;
				vertical-align: middle;" />
			Forms in Production</div>
		<div id="Div3" style="display: inline;">
			<img alt="" src="~/Content/images/staginglegend1.png" align="middle" style="width: 16px;
				vertical-align: middle;" />
			Forms in Staging</div>
	</div>
	<div style="clear: both;">
	</div>
	<!-- <a href="#" class="show_hide">Show/hide</a>-->
	@using (Html.BeginForm(null, null, FormMethod.Post, new { id = "formsList" }))
	{
		
	
		<div class="section group" id="main">
			<div id="left" class="col span_1_of_3">
				@Html.Partial("ListForms", Model.FormList)
			</div>
			<div id="right" class="col span_1_of_3" style="background: white; min-width: 800px;">
			   @* @Html.Partial("ListResponses", Model)*@
			</div>
		  
		</div>
	}
	<div id="settingscontent" style="height:0;">
	   
	</div>
	<div id="exitdialog" title="Delete Record" >

			
			   <p style="font-size:1.20em; font-weight:600;">Are you sure you want to delete this record? </p>
				
			 
		   </div>
</div>
 <div id="TimeOutdialog" title="Your session is about to expire!">
				<p>
					<span class="ui-icon ui-icon-alert" style="float:left; margin:0 7px 20px 0;"></span>
					You will be logged off in <span id="dialog-countdown" style="font-weight:bold"></span>
				</p>

				<p>Do you want to continue your session?</p>
			 </div>
<input id="FORM_ID_HIDDEN" type="hidden" />
<input id="FORM_MODE_HIDDEN" type="hidden" />

@*</div>  
  </div> *@ 
		 
